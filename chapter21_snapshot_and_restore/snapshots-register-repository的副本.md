#快照和恢复

快照是从正在运行的Elasticsearch群集中获取的备份。您可以拍摄整个集群的快照，包括其所有索引。您还可以仅拍摄群集中特定索引的快照。

必须先[注册快照存储库]()，然后才能[创建快照]()。

快照可以存储在本地或远程存储库中。远程存储库可以驻留在AmazonS3、HDFS、Microsoft Azure、Google云存储以及[存储库插件]()支持的其他平台上。

快照是增量的：索引的每个快照只存储不属于以前快照的数据。这使您能够以最小的开销频繁拍摄快照。

您可以将[快照还原]()到正在运行的群集，默认情况下，该群集包含快照中的所有索引。但是，您可以选择仅从快照恢复集群状态或特定索引。

您可以使用[快照生命周期管理]()来自动获取和管理快照。

> 仅通过复制Elasticsearch群集所有节点的数据目录，无法备份该群集。Elasticsearch可能在运行时更改其数据目录的内容；复制其数据目录不能期望捕获其内容的一致图片。如果尝试从此类备份还原群集，它可能会失败并报告损坏和丢失的文件。或者，它可能看起来成功了，尽管它默默地丢失了一些数据。备份群集的唯一可靠方法是使用快照和恢复功能。

##版本兼容性

> 版本兼容性是指基础Lucene索引的兼容性。在版本之间迁移时，请遵循升级文档。

快照包含组成索引的磁盘上数据结构的副本。这意味着快照只能还原为可以读取索引的Elasticsearch版本。

下表显示了版本之间的快照兼容性。第一列表示可以从中恢复快照的基本版本。


|  快照版本   | 2.x  | 5.x | 6.x | 7.x | 8.x |
|  ----  | ----  | ----  | ----  | ----  | ----  |
| 1.x →  | <font color=#00f4a460 >√</font> |<font color=#ff0000 >X</font>|<font color=#ff0000 >X</font>|<font color=#ff0000 >X</font>|<font color=#ff0000 >X</font>
| 2.x →   | <font color=#00f4a460 >√</font> |<font color=#00f4a460 >√</font>|<font color=#ff0000 >X</font>|<font color=#ff0000 >X</font>|<font color=#ff0000 >X</font>
| 5.x →  |  <font color=#ff0000 >X</font> |<font color=#00f4a460 >√</font>|<font color=#00f4a460 >√</font>|<font color=#ff0000 >X</font>|<font color=#ff0000 >X</font>
| 6.x →   |  <font color=#ff0000 >X</font> |<font color=#ff0000 >X</font>|<font color=#00f4a460 >√</font>|<font color=#00f4a460 >√</font>|<font color=#ff0000 >X</font>
| 7.x →   | <font color=#ff0000 >X</font> |<font color=#ff0000 >X</font>|<font color=#ff0000 >X</font>|<font color=#00f4a460 >√</font>|<font color=#00f4a460 >√</font>


以下条件适用于跨版本还原快照和索引：

* **快照**：您无法将快照从更高版本的Elasticsearch恢复到运行中的更早版本的Elasticsearch的集群中。例如，无法将7.6.0中拍摄的快照恢复到运行7.5.0的群集。
* **索引**：无法将索引还原到运行中的Elasticsearch版本的集群中，该版本比用于快照索引的Elasticsearch版本更新多个主版本。例如，无法将索引从5.0中拍摄的快照恢复到运行中的7.0的群集。

> 需要注意的是，Elasticsearch 2.0拍摄的快照可以在运行中的Elasticsearch 5.0的集群中恢复。

每个快照都可以包含在不同版本的Elasticsearch中创建的索引，在恢复快照时，必须能够将所有索引恢复到目标集群中。如果快照中的任何索引是在不兼容的版本中创建的，则将无法还原快照。

> 在升级之前备份数据时，请记住，如果快照包含在与升级版本不兼容的版本中创建的索引，则升级后将无法恢复快照。

如果最终需要恢复与当前运行的群集版本不兼容的索引的快照，可以将其恢复到最新的兼容版本，并使用[reindex from remote]()在当前版本上重建索引。只有在原始索引启用了源的情况下，才能从远程重新编制索引。检索和重新索引数据可能比简单地恢复快照花费更长的时间。如果您有大量数据，我们建议在继续之前使用您的数据子集从远程进程测试重新索引，以了解时间要求。



