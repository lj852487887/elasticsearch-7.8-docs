##可伸缩性和弹性：集群、节点和分片

Elasticsearch始终可用，并可根据您的需要进行扩展。它是通过自然分配来实现的。您可以将服务器（节点）添加到集群以增加容量，Elasticsearch会自动将数据和查询负载分布到所有可用节点。无需大修应用程序，Elasticsearch知道如何平衡多节点群集以提供规模和高可用性。节点越多越好。



这是怎么回事？实际上，Elasticsearch索引只是一个或多个物理分片的逻辑分组，其中每个分片实际上是一个自包含索引。通过将索引中的文档分布在多个分片上，并将这些分片分布在多个节点上，Elasticsearch可以确保冗余，这既可以防止硬件故障，又可以在节点添加到集群时增加查询容量。随着集群的增长（或收缩），Elasticsearch会自动迁移分片以重新平衡集群。



分片有两种类型：主碎片和副本分片。索引中的每个文档都属于一个主分片。副本分片是主分片的副本。副本提供了数据的冗余副本，以防止硬件故障，并增加了服务于读取请求（如搜索或检索文档）的容量。



索引中主分片的数量在创建索引时是固定的，但副本分片的数量可以随时更改，而不中断索引或查询操作。



###这取决于

对于分片大小和为索引配置的主分片的数量，有许多性能方面的考虑和权衡。分片越多，维护这些索引的开销就越大。当Elasticsearch需要重新平衡集群时，分片大小越大，移动分片的时间就越长。



查询大量的小分片可以加快每个分片的处理速度，但是查询越多意味着开销就越大，因此查询较少数量的较大分片可能会更快。简言之…视情况而定。



作为起点：



* 目的将平均分片大小保持在几GB到几十GB之间。对于使用基于时间的数据的用例，通常可以看到20GB到40GB范围内的分片。
* 避免无数分片的问题。节点可以容纳的碎片数量与可用堆空间成比例。一般来说，每GB堆空间的碎片数应小于20。

为您的用例确定最佳配置的最佳方法是[使用您自己的数据和查询进行测试]()。



###万一发生灾难

出于性能原因，集群中的节点需要在同一网络上。在不同数据中心的节点之间平衡集群中的碎片需要很长时间。但是高可用性架构要求您避免将所有的鸡蛋放在一个篮子里。在一个位置发生重大停机的情况下，另一个位置的服务器需要能够接管。天衣无缝。答案是什么？跨群集复制（CCR）。



CCR提供了一种将索引从主集群自动同步到可以用作热备份的辅助远程集群的方法。如果主集群出现故障，则辅助集群可以接管。您还可以使用CCR创建辅助集群，以便在地理位置接近您的用户的情况下为读取请求提供服务。



跨群集复制是主动-被动的。主集群上的索引是活动的领导索引，处理所有写请求。复制到辅助群集的索引是只读的跟随者。



###护理和保养

与任何企业系统一样，您需要工具来保护、管理和监控您的Elasticsearch集群。集成到Elasticsearch中的安全、监视和管理功能使您能够将[Kibana]()用作管理集群的控制中心。[data rollups]()和[index lifecycle management]()等功能可帮助您随着时间的推移智能地管理数据。